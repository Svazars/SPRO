# SPRO

Superior Processor with RAM Overflow

## Prerequisites

Для работы с SPRO вам понадобится JDK/JRE версии 8 и выше.
> Можно загрузить по [ссылке](https://www.oracle.com/java/technologies/downloads/).

Для сборки из исходников вам понадобится актуальная версия Scala и sbt.
> Можно загрузить по [ссылке](https://www.scala-lang.org/download/).

## Getting started

Скачайте последний [spro.jar](https://github.com/Svazars/SPRO/releases/download/latest/spro.jar).
Либо [соберите](#build) его из исходников.

Проверьте, что у вас установлена java подходящей версии:
```bash
java -ea -esa -jar spro.jar
```
должен напечататься help для эмулятора.

### Assembler

Создайте свою очень простую программу `simple.asm`
```bash
echo "halt" > simple.asm
```
Превратите её в "машинный код"

```bash
java -ea -esa -jar spro.jar simple.asm
```
и в текущей директории появится `simple.bin`.

### Run program

Подсоедините к процессору 256 байт памяти, загрузите по адресу ноль
свою программу и дайте ей исполняться не более чем 100 тактов:
```bash
java -ea -esa -jar spro.jar simple.bin exec 100 256
```

### Debugger

Подсоедините к процессору 256 байт памяти, загрузите по адресу ноль
свою программу и поотлаживайтесь в интерактивном режиме:
```bash
java -ea -esa -jar spro.jar simple.bin debug-novis 256
```

Напечатайте help и появится справка по поддерживаемым командам.

Полная спецификация с примерами [тут](/documentation/spec.markdown).

### Deathmatch 

Запустить несколько программ в пошаговом режиме можно с помощью опции `deathmatch`:
```
java -ea -esa -jar spro.jar deathmatch 10 256 0 p1.bin 0 p2.bin 0
```

В этом режиме:

1. код программ загружается в равноудаленные области памяти размером 256 байт (размер задается третьим аргументом),
1. по очереди работают программы p1.bin и p2.bin. Каждой из них дается по 50 + случайное количество от 0 до 25 тактов на ход (да еще добавка - параметры, которые идут после имен програм в списке аргументов),
1. процесс заканчивается, когда остается только одна программа, не выполнившая `halt`,
1. второй аргумент отвечает за режим `turns_until_sudden_death` - после указанного количества ходов каждый ход в случайных местах в памяти начинают появляться команды `halt`.

### Visualizer

В режиме `deathmatch` для части ходов сохраняется информация для последующей визуализации.
Просмотреть получившееся изображение (для запуска на поле размером 256) можно с помощью команды:

```
java -ea -esa -jar spro.jar replay fight.replay 1 256
```

Визуализатор изображает память, при том:

1. Синим цветом обозначает `pc` любой из програм,
2. Красным цветом обозначает `halt` в памяти,
3. Зеленым цветом обозначает любой код в памяти,
4. Белым цветом - `nop`.

## Building from source

### Build

Собрать `spro.jar` из исходников можно с помощью команды
```bash
sbt assembly
```

Результирующий `.jar` файл появится в директории `target/build`.

### Run

Также можно напрямую запускать SPRO из sbt:
```bash
sbt run simple.asm
```

### Test

Запустить интеграционные тесты можно с помощью
```bash
sbt runTests
```
или
```bash
./run-tests.sh
```

